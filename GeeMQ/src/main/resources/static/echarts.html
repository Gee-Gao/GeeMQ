<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>ECharts 示例</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">
		<!--App自定义的css-->
		<!-- <link rel="stylesheet" type="text/css" href="../css/app.css" /> -->
		<style>
			.chart {
				height: 200px;
				margin: 0px;
				padding: 0px;
			}

			h5 {
				margin-top: 30px;
				font-weight: bold;
			}

			h5:first-child {
				margin-top: 15px;
			}
		</style>
		<script src="js/mui.min.js"></script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">chart（EChart图表）</h1>
		</header>
		<div class="mui-content">
			<div class="mui-content-padded">
				<h5>天数占比</h5>
				<div class="chart" id="percentData"></div>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/mui.enterfocus.js"></script>
		<script src="js/app.js"></script>
		<script src="js/config.js"></script>
		<script src="libs/echarts-all.js"></script>
		<script>
			(function($, doc) {
				$.init();


				$.plusReady(function() {
					var settingPage = $.preload({
						"id": 'setting',
						"url": 'setting.html'
					});

					var userinfoJson = localStorage.getItem("userInfo");

					var userinfo = JSON.parse(userinfoJson);
					mui.ajax(serverAddr + "/aunt/calc/echarts", {
						data: {
							"id": userinfo.id
						},
						dataType: 'json', //服务器返回json格式数据
						type: 'post', //HTTP请求类型
						timeout: 10000, //超时时间设置为10秒；
						headers: {
							'Content-Type': 'application/json'
						},
						success: function(data) {
							var calcData = data.data;

							var percentData = document.getElementById('percentData');

							var pieChart = echarts.init(percentData);
							option = {
								series: [{
									name: '类型',
							 	type: 'pie',
							 	radius: '55%',
									center: ['50%', '60%'],
									data: calcData,
									itemStyle: {
										emphasis: {
											shadowBlur: 10,
											shadowOffsetX: 0,
											shadowColor: 'rgba(0, 0, 0, 0.5)'
										},
										normal: {
											label: {
												show: true,
												formatter: '{b} ({d}%)' //带当前图例名 + 百分比
												// formatter: '{d}%' //只要百分比
											},
											labelLine: {
												show: true
											}
										}
									}
								}]
							}
							pieChart.setOption(option);
						},
						error: function(xhr, type, errorThrown) {
							//异常处理；
							if (type == "timeout") {
								plus.nativeUI.toast("请求超时");
							} else {
								plus.nativeUI.toast("请求失败");
							}
						}
					});



					$.oldBack = mui.back;
					var backButtonPress = 0;
					$.back = function(event) {
						backButtonPress++;
						if (backButtonPress > 1) {
							plus.runtime.quit();
						} else {
							plus.nativeUI.toast('再按一次退出应用');
						}
						setTimeout(function() {
							backButtonPress = 0;
						}, 1000);
						return false;
					};
				});
			}(mui, document));
		</script>
	</body>

</html>
